{"version":"NotebookV1","origId":3004872900977144,"name":"17_DeltaTables_SCD_type2","language":"python","commands":[{"version":"CommandV1","origId":3004872900977145,"guid":"06a707a7-79ce-4763-9493-03a6945c9f02","subtype":"command","commandType":"auto","position":1.0,"command":"srcfile_folder = '/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/cust_dtls'\narchive_folder = '/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/archive'","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799289886,"submitTime":1714799289816,"finishTime":1714799289967,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"96f20660-9806-42e0-b329-cc6d6c253827"},{"version":"CommandV1","origId":3004872900977147,"guid":"15e0682d-1e51-497d-ad4e-6a01ad62969e","subtype":"command","commandType":"auto","position":2.0,"command":"dbutils.fs.mkdirs(srcfile_folder)\ndbutils.fs.mkdirs(archive_folder)","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[39]: True","name":"stdout","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799289985,"submitTime":1714799289817,"finishTime":1714799290173,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",13]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d6e88f65-65fd-45a7-9edd-f42bd9538d13"},{"version":"CommandV1","origId":3004872900977148,"guid":"5d2b2300-73c7-4ce0-a317-b7fa734be96d","subtype":"command","commandType":"auto","position":3.0,"command":"df = spark.read.format(\"csv\").option(\"header\",True).load(srcfile_folder+'/*.csv')","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"cust_id","nullable":true,"type":"string"},{"metadata":{},"name":"cust_name","nullable":true,"type":"string"},{"metadata":{},"name":"address","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799290185,"submitTime":1714799289819,"finishTime":1714799291273,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5e5d52bb-0f59-4ea4-8367-9a2df6d2f72d"},{"version":"CommandV1","origId":3004872900977149,"guid":"36d6b559-2321-4a83-8593-2605603b543b","subtype":"command","commandType":"auto","position":4.0,"command":"df.show()","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"+-------+---------+---------+\n|cust_id|cust_name|  address|\n+-------+---------+---------+\n|     C1| srinivas|bangalore|\n|     C2|    Phani|     Pune|\n|     C3|      Ram|Hyderabad|\n|     C4|  Krishna|Hyderabad|\n|     C5|   Mahesh|Bangalore|\n+-------+---------+---------+\n\n","name":"stdout","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799291285,"submitTime":1714799289820,"finishTime":1714799291675,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",271]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5c7831ff-fa02-4f2f-9d77-6de492361d2e"},{"version":"CommandV1","origId":3004872900977150,"guid":"50261a01-a523-453b-b4e4-517f5eefe53e","subtype":"command","commandType":"auto","position":5.0,"command":"%sql \n\ncreate database if not exists stage\nlocation '/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/stage'","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799291682,"submitTime":1714799289822,"finishTime":1714799291776,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ad0abb71-97d9-4adc-ad83-9e126adc3795"},{"version":"CommandV1","origId":3004872900977151,"guid":"e013e811-a221-4ee9-98f2-52fdcb2ebab2","subtype":"command","commandType":"auto","position":6.0,"command":"%sql\n\ncreate table if not exists stage.cust_stg\n(\n  cust_id string, \n  cust_name string, \n  address string\n)\nusing delta \nlocation '/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/stage/cust_stg'","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799291790,"submitTime":1714799289823,"finishTime":1714799291977,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2bcf483f-8272-4bab-876a-d0060db7e0e5"},{"version":"CommandV1","origId":3004872900977152,"guid":"b270eebb-28b8-4b5d-8ebd-9975e2db44f8","subtype":"command","commandType":"auto","position":7.0,"command":"df.write.format(\"delta\").mode(\"overwrite\").saveAsTable(\"stage.cust_stg\")","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799291983,"submitTime":1714799289825,"finishTime":1714799296294,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b86b470f-52ac-4118-95e1-e8639a2f026c"},{"version":"CommandV1","origId":3004872900977153,"guid":"acf5d4fb-04bd-4048-8332-79d12a8fb8d8","subtype":"command","commandType":"auto","position":8.0,"command":"%sql \n\nselect * from stage.cust_stg","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[["C1","srinivas","bangalore"],["C2","Phani","Pune"],["C3","Ram","Hyderabad"],["C4","Krishna","Hyderabad"],["C5","Mahesh","Bangalore"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"cust_id","type":"\"string\"","metadata":"{}"},{"name":"cust_name","type":"\"string\"","metadata":"{}"},{"name":"address","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"cust_id","nullable":true,"type":"string"},{"metadata":{},"name":"cust_name","nullable":true,"type":"string"},{"metadata":{},"name":"address","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799296302,"submitTime":1714799289827,"finishTime":1714799297405,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",5]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"935c6741-aac0-4153-82e6-5eb3c29ccc9d"},{"version":"CommandV1","origId":3004872900977154,"guid":"e8162a23-f6cc-4560-b899-fbf99e38377e","subtype":"command","commandType":"auto","position":9.0,"command":"%sql \n\ncreate database if not exists target\nlocation '/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/target'","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799297412,"submitTime":1714799289828,"finishTime":1714799297605,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fda8ac75-06df-4539-8e40-535af6a3fc5b"},{"version":"CommandV1","origId":3004872900977155,"guid":"7a3d7634-0cea-4fb5-a49e-413641c5cac3","subtype":"command","commandType":"auto","position":10.0,"command":"%sql\n\ncreate table if not exists target.customer_type2\n(\n  cust_id string, \n  cust_name string, \n  address string, \n  start_dt date, \n  end_dt date, \n  isActive string \n)\nusing delta\nlocation '/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/target/customer_type2'","commandVersion":8,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799297610,"submitTime":1714799289830,"finishTime":1714799297808,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",0]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fe7560c9-28a3-4826-a766-760d9eb4f2c2"},{"version":"CommandV1","origId":3004872900977157,"guid":"ec190551-9612-4a08-ac59-64dceef2e06b","subtype":"command","commandType":"auto","position":12.0,"command":"%sql \n\nmerge into target.customer_type2  tgt \nusing \n(\n    select\n    cs.cust_id as mergekey , \n    cs.*\n    from stage.cust_stg cs \n\n    union all \n\n    select \n    null as mergekey, \n    cs.*\n    from target.customer_type2 c \n    inner join stage.cust_stg cs\n    on c.cust_id = cs.cust_id \n    and c.address <> cs.address and c.isActive = 'Y'\n)src \non tgt.cust_id = src.mergekey \n\nwhen matched and tgt.address <> src.address then update  set end_dt = current_date()-1 , isActive = 'N'\n\nwhen not matched then \ninsert \n(\ntgt.cust_id, \ntgt.cust_name, \ntgt.address, \ntgt.start_dt, \ntgt.end_dt, \ntgt.isActive\n)\nvalues \n(  \n  src.cust_id, \n  src.cust_name, \n  src.address, \n  current_date(), \n  null , \n  'Y'\n)\n","commandVersion":57,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[5,3,0,2]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"num_affected_rows","type":"\"long\"","metadata":"{}"},{"name":"num_updated_rows","type":"\"long\"","metadata":"{}"},{"name":"num_deleted_rows","type":"\"long\"","metadata":"{}"},{"name":"num_inserted_rows","type":"\"long\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"num_affected_rows","nullable":true,"type":"long"},{"metadata":{},"name":"num_updated_rows","nullable":true,"type":"long"},{"metadata":{},"name":"num_deleted_rows","nullable":true,"type":"long"},{"metadata":{},"name":"num_inserted_rows","nullable":true,"type":"long"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799300248,"submitTime":1714799289833,"finishTime":1714799310493,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",1]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5c06f002-1a7c-49ba-bd07-3b0dd74c83ee"},{"version":"CommandV1","origId":3004872900977158,"guid":"5cfd3ab9-802b-469a-ae40-777ec2085392","subtype":"command","commandType":"auto","position":13.0,"command":"%sql\n\nselect * from target.customer_type2","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[["C1","srinivas","Hyderabad","2024-05-04","2024-05-03","N"],["C2","Phani","Chennai","2024-05-04","2024-05-03","N"],["C3","Ram","Delhi","2024-05-04","2024-05-03","N"],["C5","Mahesh","Bangalore","2024-05-04",null,"Y"],["C1","srinivas","bangalore","2024-05-04",null,"Y"],["C3","Ram","Hyderabad","2024-05-04",null,"Y"],["C4","Krishna","Hyderabad","2024-05-04",null,"Y"],["C2","Phani","Pune","2024-05-04",null,"Y"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"cust_id","type":"\"string\"","metadata":"{}"},{"name":"cust_name","type":"\"string\"","metadata":"{}"},{"name":"address","type":"\"string\"","metadata":"{}"},{"name":"start_dt","type":"\"date\"","metadata":"{}"},{"name":"end_dt","type":"\"date\"","metadata":"{}"},{"name":"isActive","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"cust_id","nullable":true,"type":"string"},{"metadata":{},"name":"cust_name","nullable":true,"type":"string"},{"metadata":{},"name":"address","nullable":true,"type":"string"},{"metadata":{},"name":"start_dt","nullable":true,"type":"date"},{"metadata":{},"name":"end_dt","nullable":true,"type":"date"},{"metadata":{},"name":"isActive","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799310499,"submitTime":1714799289835,"finishTime":1714799311906,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",8]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e51161fd-0a14-4a28-8db6-941dbef3d025"},{"version":"CommandV1","origId":3004872900977159,"guid":"c8e24bb5-c6ad-444b-9f83-9ba0f39a813d","subtype":"command","commandType":"auto","position":14.0,"command":"files_lst = dbutils.fs.ls(srcfile_folder)","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799311930,"submitTime":1714799289837,"finishTime":1714799312107,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2795b3f6-53d4-4bcf-a5d9-5e471027d4f4"},{"version":"CommandV1","origId":3004872900977160,"guid":"c16d2ba5-57de-439a-a5c8-37a55da50299","subtype":"command","commandType":"auto","position":15.0,"command":"for file in files_lst:\n    dbutils.fs.mv(file.path,archive_folder)","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799312111,"submitTime":1714799289838,"finishTime":1714799312507,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b237fd6a-1da7-4836-a868-c2a246ab400c"},{"version":"CommandV1","origId":3004872900977161,"guid":"02934ac3-7b8e-4dfe-bca3-dbe7d25de611","subtype":"command","commandType":"auto","position":16.0,"command":"dbutils.fs.ls(archive_folder)","commandVersion":1,"state":"finished","results":{"type":"listResults","data":[{"type":"ansi","data":"Out[53]: [FileInfo(path='dbfs:/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/archive/cust_july.csv', name='cust_july.csv', size=126, modificationTime=1714799313000),\n FileInfo(path='dbfs:/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/archive/cust_june.csv', name='cust_june.csv', size=108, modificationTime=1714799158000),\n FileInfo(path='dbfs:/FileStore/shared_uploads/pvrcloudtech@gmail.com/AVD/archive/cust_may.csv', name='cust_may.csv', size=82, modificationTime=1714798942000)]","name":"stdout","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799312513,"submitTime":1714799289840,"finishTime":1714799312710,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["ansi",494]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"70cfb6e5-1f67-4025-a3ba-93a77113e325"},{"version":"CommandV1","origId":3004872900977162,"guid":"40d149cd-3228-43a4-a20a-7585b3df9b80","subtype":"command","commandType":"auto","position":11.0,"command":"%sql \n\nselect\n    cs.cust_id as mergekey , \n    cs.*\n    from stage.cust_stg cs \n\n    union all \n\n    select \n    null as mergekey, \n    cs.*\n    from target.customer_type2 c \n    inner join stage.cust_stg cs\n    on c.cust_id = cs.cust_id \n    and c.address <> cs.address and c.isActive = 'Y'","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[["C1","C1","srinivas","bangalore"],["C2","C2","Phani","Pune"],["C3","C3","Ram","Hyderabad"],["C4","C4","Krishna","Hyderabad"],["C5","C5","Mahesh","Bangalore"],[null,"C2","Phani","Pune"]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"mergekey","type":"\"string\"","metadata":"{}"},{"name":"cust_id","type":"\"string\"","metadata":"{}"},{"name":"cust_name","type":"\"string\"","metadata":"{}"},{"name":"address","type":"\"string\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"_sqldf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"mergekey","nullable":true,"type":"string"},{"metadata":{},"name":"cust_id","nullable":true,"type":"string"},{"metadata":{},"name":"cust_name","nullable":true,"type":"string"},{"metadata":{},"name":"address","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1714799297814,"submitTime":1714799289831,"finishTime":1714799300233,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{"rowLimit":10000,"byteLimit":2048000,"implicitDf":true},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",6]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"78ebcd2b-ce2c-4588-a92b-1346ee734f5f"}],"dashboards":[],"guid":"6b6bc7de-f3d0-4cc4-9e2d-e36b00c0586b","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4,"mostRecentlyExecutedCommandWithImplicitDF":{"commandId":3004872900977158,"dataframes":["_sqldf"]}},"reposExportFormat":"SOURCE"}